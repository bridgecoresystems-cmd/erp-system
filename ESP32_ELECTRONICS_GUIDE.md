# 🔌 ESP32 Электроника - Резисторы и Подключения

## 📋 Содержание
1. [Резисторы для LED](#резисторы-для-led)
2. [Резисторы для датчиков](#резисторы-для-датчиков)
3. [Защитные компоненты](#защитные-компоненты)
4. [Полная схема подключения](#полная-схема)
5. [Список компонентов для покупки](#список-компонентов)

---

## 1️⃣ Резисторы для LED

### Основная формула расчета:

```
R = (Vcc - Vled) / Iled

Где:
  Vcc  - напряжение питания (3.3V для ESP32)
  Vled - падение напряжения на LED
  Iled - ток через LED
```

### Типы LED и их резисторы:

| Цвет LED | Падение напряжения (Vled) | Ток (Iled) | Резистор | Стандарт |
|----------|---------------------------|-----------|----------|----------|
| **Красный** | 1.8V - 2.0V | 20mA | **75 Ω** | **100 Ω** ✅ |
| **Зеленый** | 2.0V - 2.2V | 20mA | **55 Ω** | **68 Ω** ✅ |
| **Синий** | 3.0V - 3.2V | 20mA | **15 Ω** | **22 Ω** ✅ |
| **Желтый** | 2.0V - 2.2V | 20mA | **55 Ω** | **68 Ω** ✅ |
| **Белый** | 3.0V - 3.4V | 20mA | **10 Ω** | **22 Ω** ✅ |

### Пример расчета для КРАСНОГО LED:

```
R = (3.3V - 2.0V) / 0.02A = 1.3V / 0.02A = 65 Ω
Ближайший стандарт: 68 Ω или 100 Ω ✅
```

### ⚠️ Важно:
- **100 Ω - 220 Ω** - универсальный диапазон для всех LED на ESP32
- Больше сопротивление = тусклее LED (безопаснее)
- Меньше сопротивление = ярче LED (риск перегрева)

### 🎯 Рекомендация:
**Используйте 220 Ω для всех LED** - универсально и безопасно!

---

## 2️⃣ Резисторы для датчиков

### A. RFID RC522 модуль

**Не требует резисторов!** Подключается напрямую к ESP32:

```
RC522 → ESP32
SDA   → GPIO 21
SCK   → GPIO 18
MOSI  → GPIO 23
MISO  → GPIO 19
IRQ   → не подключать
GND   → GND
RST   → GPIO 22
3.3V  → 3.3V
```

⚠️ **Важно:** RC522 работает только от **3.3V**, не подключайте к 5V!

---

### B. Датчик Холла (для подсчета импульсов)

**Тип 1: NPN транзисторный выход (3-проводной)**

```
Датчик → Резистор → ESP32
OUT    → 10 кОм   → GPIO 34 (pullup)
       └ 10 кОм   → GND (pulldown) ← ВАЖНО!
```

**Резисторы:**
- **1x 10 кОм (pullup)** - подтяжка к HIGH
- **1x 10 кОм (pulldown)** - подтяжка к GND

**Схема подключения:**
```
Датчик VCC → 5V (или 12V от станка)
Датчик GND → GND общий
Датчик OUT → 10кОм → 3.3V (pullup)
           └ 10кОм → GND (pulldown)
           └ GPIO 34
```

---

**Тип 2: PNP транзисторный выход**

```
Датчик → Резистор → ESP32
OUT    → 10 кОм   → GPIO 34
       └ 10 кОм   → 3.3V (pullup)
```

---

**Тип 3: Оптоизолированный выход (РЕКОМЕНДУЕТСЯ для станка!)**

```
Датчик OUT → Оптопара PC817
           → 220 Ω → 3.3V
           → GPIO 34
```

**Компоненты:**
- **1x PC817 (оптопара)** - изоляция от помех станка
- **1x 220 Ω** - ограничитель тока для LED оптопары
- **1x 10 кОм** - pullup для выхода

---

### C. Кнопки (для вызова мастера)

```
Кнопка → Резистор → ESP32
       → 10 кОм   → GND (pulldown)
       → GPIO 25

+ Конденсатор 0.1 μF параллельно кнопке (антидребезг)
```

**Резисторы:**
- **1x 10 кОм (pulldown)** - чтобы на GPIO был LOW когда кнопка не нажата
- **1x 0.1 μF (100nF) конденсатор** - устранение дребезга

---

### D. DHT22 датчик температуры/влажности (если используете)

```
DHT22 → Резистор → ESP32
DATA  → 4.7 кОм  → 3.3V (pullup)
      └ GPIO 4
```

**Резисторы:**
- **1x 4.7 кОм (pullup)** - обязательный резистор для DHT22

---

### E. Потенциометры (регулировка скорости и т.д.)

```
Потенциометр (10 кОм) → GPIO 36 (ADC1)

Средний вывод → GPIO 36
Крайние выводы → 3.3V и GND
```

**Компоненты:**
- **1x 10 кОм потенциометр** - для регулировки

---

## 3️⃣ Защитные компоненты (КРИТИЧНО для станка!)

### A. Стабилизатор напряжения

Для питания ESP32 от станка (12V/24V):

**Компоненты:**
- **AMS1117-3.3** стабилизатор 3.3V (или LM2596 step-down модуль)
- **2x 10 μF электролитический конденсатор** (вход/выход)
- **2x 0.1 μF керамический конденсатор** (развязка)

**Схема:**
```
Станок 12V → [10μF + 0.1μF] → AMS1117-3.3 → [10μF + 0.1μF] → ESP32 3.3V
             GND            → GND          → GND           → GND
```

---

### B. Защита входов ESP32

**Для КАЖДОГО входного сигнала от станка:**

```
Сигнал станка → Резистор → Диод → ESP32 GPIO
             ↓    1 кОм      ↓
             └──── 10 кОм → GND

Диод Шоттки (1N5819) катодом к 3.3V - защита от перенапряжения
```

**Компоненты на КАЖДЫЙ вход:**
- **1x 1 кОм** - ограничитель тока
- **1x 10 кОм** - pulldown к GND
- **1x 1N5819 диод Шоттки** - защита от перенапряжения

---

### C. Конденсаторы питания ESP32

**Обязательно на плате ESP32:**

```
3.3V → [100 μF электролит] → GND  (рядом с ESP32)
    └→ [0.1 μF керамика]   → GND  (максимально близко к VCC пину)
```

**Компоненты:**
- **1x 100 μF электролитический** - сглаживание пульсаций
- **2-3x 0.1 μF керамический** - фильтрация высокочастотных помех

---

### D. Оптоизоляция (для промышленного станка)

**PC817 оптопара для изоляции сигналов:**

```
Сигнал станка → 220 Ω → LED оптопары → GND станка
                                     
Фототранзистор → 3.3V (через 10кОм)
               → GPIO ESP32
               → GND ESP32
```

**Компоненты на КАЖДЫЙ канал:**
- **1x PC817 оптопара**
- **1x 220 Ω** - для LED
- **1x 10 кОм** - pullup для транзистора

---

## 4️⃣ Полная схема подключения Lohia Monitor

### Что подключаем:
1. RC522 RFID считыватель
2. Датчик Холла (импульсы от станка)
3. 3x LED индикаторы (статус)
4. 1x Кнопка (вызов мастера)

### Схема:

```
ESP32 DevKit v1
═══════════════════════════════════════════════════

ПИТАНИЕ:
┌─────────────────┐
│ Станок 12V      │
│       ↓         │
│   AMS1117-3.3   │ + 10μF (вход)
│       ↓         │ + 0.1μF (вход)
│     3.3V        │ + 10μF (выход)
│       ↓         │ + 0.1μF (выход)
│   ESP32 VCC     │ + 100μF (на плате)
└─────────────────┘

RFID RC522:
┌─────────────────┐
│ SDA   → GPIO 21 │ (без резисторов)
│ SCK   → GPIO 18 │
│ MOSI  → GPIO 23 │
│ MISO  → GPIO 19 │
│ RST   → GPIO 22 │
│ 3.3V  → 3.3V    │
│ GND   → GND     │
└─────────────────┘

ДАТЧИК ХОЛЛА (импульсы):
┌──────────────────────────┐
│ Датчик OUT → PC817 LED → │ 220 Ω → GND станка
│              PC817 OUT → │ 10 кОм → 3.3V
│                       └→ │ GPIO 34
│ Датчик VCC → 12V станка  │
│ Датчик GND → GND общий   │
└──────────────────────────┘

LED ИНДИКАТОРЫ:
┌─────────────────┐
│ GPIO 16 → 220Ω → LED зеленый → GND  (Работает)
│ GPIO 17 → 220Ω → LED желтый  → GND  (Ожидание)
│ GPIO 5  → 220Ω → LED красный → GND  (Вызов мастера)
└─────────────────┘

КНОПКА ВЫЗОВА МАСТЕРА:
┌─────────────────┐
│ GPIO 25 ─┬─ Кнопка ─ 3.3V
│          │
│          └─ 10кОм ─ GND (pulldown)
│          └─ 0.1μF ─ GND (антидребезг)
└─────────────────┘
```

---

## 5️⃣ Список компонентов для покупки

### Обязательные компоненты:

#### Резисторы (1/4 Вт):
- ✅ **10x 220 Ω** - для LED (универсальные)
- ✅ **10x 1 кОм** - защита входов
- ✅ **10x 10 кОм** - pullup/pulldown
- ✅ **2x 4.7 кОм** - для DHT22 (если используете)

💡 **Совет:** Купи набор резисторов E12 (100шт разных номиналов) - ~$2-3

---

#### Конденсаторы:

**Электролитические:**
- ✅ **2x 10 μF (16V)** - для стабилизатора (вход/выход)
- ✅ **1x 100 μF (16V)** - для питания ESP32
- ✅ **2x 470 μF (25V)** - дополнительная фильтрация (опционально)

**Керамические:**
- ✅ **10x 0.1 μF (100nF)** - развязка и антидребезг
- ✅ **2x 1 μF** - дополнительная фильтрация

💡 **Совет:** Купи набор конденсаторов (50-100шт) - ~$3-5

---

#### Полупроводники:

- ✅ **1x AMS1117-3.3** стабилизатор напряжения (или LM2596 модуль)
- ✅ **3-5x PC817** оптопара (изоляция сигналов от станка)
- ✅ **5x 1N5819** диод Шоттки (защита от перенапряжения)
- ✅ **1x 1N4007** диод (обратная защита питания)

---

#### LED индикаторы:

- ✅ **1x LED зеленый** 5мм (работает)
- ✅ **1x LED желтый** 5мм (ожидание)
- ✅ **1x LED красный** 5мм (вызов мастера)
- ✅ **1x LED синий** 5мм (WiFi статус) - опционально

💡 **Совет:** Купи набор разноцветных LED (100-200шт) - ~$3

---

#### Датчики и модули:

- ✅ **1x ESP32 DevKit v1** (30 GPIO)
- ✅ **1x RC522 RFID модуль** (13.56 MHz)
- ✅ **5-10x RFID карты/брелоки** (Mifare 1K)
- ✅ **1x Датчик Холла** (NPN/PNP с напряжением 5-24V)
  - Примеры: LJ12A3-4-Z/BX, TL-W5MC1, A3144
- ✅ **1x Кнопка** тактовая 6x6мм или промышленная 16мм

---

#### Провода и разъемы:

- ✅ **Провод многожильный** 0.5 мм² (красный/черный/разноцветные)
- ✅ **Термоусадка** разных диаметров
- ✅ **Разъемы DuPont** (male-female, female-female)
- ✅ **Клеммники** винтовые 2-3 контакта
- ✅ **Экранированный кабель** для датчиков (от помех)

---

#### Дополнительно (защита от помех):

- ✅ **1-2x Ферритовое кольцо** (на проводах питания и сигналов)
- ✅ **Макетная плата** PCB или breadboard
- ✅ **Корпус** пластиковый IP54 (защита от пыли)

---

## 6️⃣ Типовые схемы подключения

### Схема 1: Простое подключение LED

```
ESP32 GPIO 16 ─────┬─── 220Ω ───┬─── LED (+) ───┬─── GND
                   │            │               │
                   │           (Анод)         (Катод)
                   │
                  3.3V
```

**Код:**
```cpp
#define LED_PIN 16

void setup() {
  pinMode(LED_PIN, OUTPUT);
}

void loop() {
  digitalWrite(LED_PIN, HIGH);  // Включить LED
  delay(1000);
  digitalWrite(LED_PIN, LOW);   // Выключить LED
  delay(1000);
}
```

---

### Схема 2: Подключение датчика с оптоизоляцией

```
                      Станок (опасная зона)     |     ESP32 (безопасная зона)
                                                |
Датчик OUT ─── 220Ω ─── LED PC817 ─── GND      |     
                                                |     Фототранзистор
                                                |            ↓
                                                |     3.3V ─ 10кОм ─ GPIO 34
                                                |                  └─ GND
```

**Компоненты:**
- PC817: 1-2 (LED вход), 3-4 (транзистор выход)
- 220 Ω на LED
- 10 кОм pullup на транзистор

---

### Схема 3: Кнопка с защитой от дребезга

```
3.3V ──┬─── Кнопка ─── GPIO 25 ──┬─── 10кОм ─── GND
       │                          │
       │                          └─── 0.1μF ─── GND
       │
      (разомкнута = LOW, нажата = HIGH)
```

**Или проще (с внутренним pulldown):**

```cpp
#define BUTTON_PIN 25

void setup() {
  pinMode(BUTTON_PIN, INPUT_PULLDOWN);  // Внутренний pulldown
}

void loop() {
  if (digitalRead(BUTTON_PIN) == HIGH) {
    // Кнопка нажата
  }
}
```

⚠️ **Внутренний pulldown ~50кОм** - слабая подтяжка. Для помех лучше внешний 10кОм!

---

## 7️⃣ Расчет питания

### Потребление тока компонентов:

| Компонент | Ток (нормальный) | Ток (пиковый) |
|-----------|------------------|---------------|
| ESP32 (WiFi ON) | 160-260 mA | 500 mA |
| RC522 RFID | 13-26 mA | 100 mA (чтение карты) |
| LED x3 | 60 mA (3x20mA) | 60 mA |
| Датчик Холла | 10-20 mA | 20 mA |
| **ИТОГО:** | **~250-350 mA** | **~680 mA** |

### Требования к блоку питания:

**Минимум:** 5V 1A (1000 mA)  
**Рекомендуется:** 5V 2A (2000 mA) или 3.3V 2A  

⚠️ **Важно:**
- Используйте **ОТДЕЛЬНЫЙ** блок питания для ESP32
- **НЕ питайте** ESP32 напрямую от станка (помехи!)
- Если питание от станка - используйте **DC-DC converter с изоляцией**

---

## 8️⃣ Рекомендуемая покупка (алиэкспресс ~$15-20)

### Базовый набор:

1. **ESP32 DevKit v1** - $3-4
2. **RC522 RFID модуль + 5 карт** - $2-3
3. **Датчик Холла LJ12A3-4-Z/BX** - $3-4
4. **Набор резисторов E12 (600шт)** - $2-3
5. **Набор конденсаторов (100шт)** - $3-4
6. **Набор LED (200шт разноцветные)** - $2
7. **PC817 оптопары (10шт)** - $1
8. **AMS1117-3.3 стабилизатор** - $1
9. **Провода DuPont** - $2
10. **Макетная плата** - $2

**ИТОГО: ~$20-25**

---

## 9️⃣ Частые ошибки и как их избежать

### ❌ Ошибка 1: LED горит слабо или не горит

**Причина:** Слишком большой резистор  
**Решение:** Уменьши до 100-220 Ω

---

### ❌ Ошибка 2: ESP32 перезагружается

**Причины:**
1. Слабое питание - купи блок питания 2A
2. Помехи от станка - добавь оптоизоляцию
3. Нет конденсаторов на питании - добавь 100μF + 0.1μF

---

### ❌ Ошибка 3: Датчик дает ложные срабатывания

**Причины:**
1. Нет pulldown резистора - добавь 10кОм к GND
2. Помехи - используй оптоизоляцию PC817
3. Плохой провод - используй экранированный кабель

---

### ❌ Ошибка 4: RC522 не читает карты

**Причины:**
1. Неправильное питание - проверь 3.3V (НЕ 5V!)
2. Неправильные пины - проверь подключение SPI
3. Слабый контакт - пропаяй разъемы

---

## 🔟 Монтаж на станке

### Рекомендации:

1. **Корпус:** IP54 пластиковый бокс с вентиляцией
2. **Расположение:** Подальше от двигателей и силовых кабелей
3. **Провода:** 
   - Питание - красный/черный 0.75мм²
   - Сигналы - витая пара или экранированный кабель
   - Длина до 3м (при большей длине - оптоизоляция обязательна)
4. **Заземление:** Общий GND между ESP32 и станком
5. **Крепление:** Не на вибрирующие части!

---

## 📦 Минимальный набор резисторов для старта

Если нужно купить **только самое необходимое:**

### Для Lohia Monitor (1 станок):

```
Резисторы (1/4 Вт):
- 10x 220 Ω  (LED)
- 5x  1 кОм  (защита входов)
- 10x 10 кОм (pullup/pulldown)

Конденсаторы:
- 2x  10 μF   (стабилизатор)
- 1x  100 μF  (питание ESP32)
- 5x  0.1 μF  (развязка)

Полупроводники:
- 1x AMS1117-3.3 (стабилизатор)
- 3x PC817 (оптопары)
- 3x 1N5819 (диоды)

ИТОГО: ~$5-7 на компоненты
```

---

## ⚡ Быстрая проверка правильности подключения

### 1. Проверка резистора для LED:

```
R (Ом) = (3.3V - Vled) / 0.02A

Красный LED: R = (3.3 - 2.0) / 0.02 = 65 Ω → используй 68-100 Ω ✅
Зеленый LED: R = (3.3 - 2.2) / 0.02 = 55 Ω → используй 68-100 Ω ✅
Синий LED:   R = (3.3 - 3.0) / 0.02 = 15 Ω → используй 22-47 Ω ✅

Универсально для всех: 220 Ω ✅
```

### 2. Проверка датчика:

- Сигнал HIGH при срабатывании → нужен pulldown 10кОм к GND
- Сигнал LOW при срабатывании → нужен pullup 10кОм к 3.3V

### 3. Проверка питания:

```cpp
void setup() {
  Serial.begin(115200);
  Serial.print("Voltage on 3.3V pin: ");
  analogRead(36);  // Прогрев ADC
  delay(100);
  float voltage = analogReadMilliVolts(36) / 1000.0;
  Serial.println(voltage);
  // Должно быть: 3.2-3.4V
}
```

---

## 🎓 Полезные ссылки

- **Калькулятор резисторов для LED:** https://ledcalc.com/
- **Даташиты:**
  - ESP32: https://www.espressif.com/sites/default/files/documentation/esp32_datasheet_en.pdf
  - PC817: https://www.farnell.com/datasheets/73758.pdf
  - AMS1117: https://www.advanced-monolithic.com/pdf/ds1117.pdf

---

## 🔥 Быстрый ответ на твой вопрос:

### Резисторы для LED:
**220 Ω** - для ВСЕХ LED (красный, зеленый, желтый, синий)

### Резисторы для датчиков:
**10 кОм** - pullup или pulldown (зависит от типа датчика)

### Купи набор:
- Резисторы E12 (~100-600шт разных) - $2-3
- Конденсаторы набор (50-100шт) - $3-5

**И все будет работать!** 🎉

---

Нужна помощь с конкретной схемой подключения? Спрашивай!

