# 📦 Инструкция по монтажу ESP32 + RC522 в коробку

## 🎯 Твоя идея - ОТЛИЧНАЯ!

**Что у тебя будет:**
- 📦 **Коробка 1:** ESP32-HR (учет рабочего времени)
- 📦 **Коробка 2:** ESP32-SEC (система безопасности)
- ⚡ Питание от USB кабеля телефона
- 📱 RC522 на крышке изнутри (двойной скотч)

---

## 🛠️ Что нужно для одной коробки:

### Электроника:
- ✅ 1x ESP32 DevKit v1
- ✅ 1x RC522 RFID модуль
- ✅ 2-3x LED 5мм (зеленый, красный, синий)
- ✅ 3x Резистор 220 Ω (для LED)
- ✅ 1x Buzzer 5V (опционально)
- ✅ Провода DuPont (male-female, ~20см)
- ✅ USB кабель micro-USB или USB-C (зависит от ESP32)
- ✅ Зарядка от телефона 5V 1-2A

### Материалы:
- ✅ Пластиковая коробка 10x8x5см (или похожая)
- ✅ Двойной скотч 3M (толщина 1-2мм)
- ✅ Термоусадка для проводов (опционально)
- ✅ Винты M3 для крепления ESP32 (или скотч)
- ✅ Дрель с сверлом 5мм (для LED)
- ✅ Сверло 8-10мм для USB кабеля

---

## 📐 Монтаж коробки (пошагово):

### Шаг 1: Подготовка коробки

```
Вид коробки:
┌─────────────────────────┐
│  КРЫШКА                 │  ← RC522 здесь (изнутри)
│  [=====RC522=====]      │
│                         │
└─────────────────────────┘

┌─────────────────────────┐
│  ПЕРЕДНЯЯ ПАНЕЛЬ        │
│  ● ●    (LED отверстия) │  ← Сверлим 2-3 дырки 5мм
│                         │
└─────────────────────────┘

┌─────────────────────────┐
│  БОКОВАЯ СТЕНКА         │
│  ╭─────╮ (USB кабель)   │  ← Отверстие 8-10мм
│  ╰─────╯                │
└─────────────────────────┘
```

**Действия:**
1. Разметь отверстия карандашом
2. Просверли:
   - 2-3 отверстия 5мм спереди (для LED)
   - 1 отверстие 8-10мм сбоку (для USB кабеля)
3. Обработай края наждачкой

---

### Шаг 2: Монтаж RC522 на крышку (ИЗНУТРИ!)

```
Вид изнутри крышки:

       [RC522 модуль]
       ▼▼▼▼▼▼▼▼▼▼▼▼
    ┌──────────────────┐
    │  [АНТЕННА]       │
    │                  │
    │  [ЧИП MFRC522]   │
    │                  │
    │  [ПИНЫ ▼▼▼▼▼▼]   │
    └──────────────────┘
         ↓ провода к ESP32
    
    ═══ ДВОЙНОЙ СКОТЧ ═══
    
    ═══════════════════════
       КРЫШКА КОРОБКИ
```

**Действия:**
1. Очисти крышку спиртом (обезжирить!)
2. Наклей 4 кусочка двойного скотча на RC522
3. Прижми RC522 к крышке **ИЗНУТРИ**
4. Провода должны свисать вниз (к ESP32)

⚠️ **ВАЖНО:** RC522 **ИЗНУТРИ** крышки, антенной ВВЕРХ!

---

### Шаг 3: Монтаж ESP32 на дно

```
Вид на дно коробки:

┌────────────────────────┐
│                        │
│    [ESP32 DevKit]      │  ← На дне коробки
│    ▓▓▓▓▓▓▓▓▓▓▓▓▓      │
│    ▓ USB ▓            │
│    ▓▓▓▓▓▓▓▓▓▓▓▓▓      │
│                        │
│  Провода к RC522 →     │
│  Провода к LED →       │
└────────────────────────┘
```

**Варианты крепления:**

**А) Винты (надежнее):**
1. Разметь 2 отверстия под ESP32
2. Просверли 2мм
3. Винты M3 (5мм длина)
4. Стойки 5мм между платой и дном

**Б) Двойной скотч (проще):**
1. Очисти дно коробки
2. 4 кусочка скотча под ESP32
3. Прижми ESP32

---

### Шаг 4: Монтаж LED на переднюю панель

```
Передняя панель (вид снаружи):

┌─────────────────────────┐
│   ESP32 HR SCANNER      │ (надпись маркером)
│                         │
│     ●        ●          │ ← 2 LED (зеленый, красный)
│   GREEN     RED         │
│                         │
└─────────────────────────┘

Для Security добавь 3-й синий:
│   ●    ●    ●           │
│  🟢   🔴   🔵          │
```

**Действия:**
1. Вставь LED в отверстия **снаружи внутрь**
2. Длинная ножка (анод) = к резистору 220Ω
3. Короткая ножка (катод) = к GND
4. Зафиксируй термоклеем или пластилином изнутри

**Схема LED:**
```
ESP32 GPIO → 220Ω → LED+ (длинная) → LED- (короткая) → GND
```

---

### Шаг 5: Прокладка проводов

```
RC522 (на крышке) → Провода вниз → ESP32 (на дне)

Цветовая маркировка (рекомендуется):
─────────────────────────────────────
RC522 → Цвет → ESP32
SDA   → Синий    → GPIO 21
SCK   → Желтый   → GPIO 18
MOSI  → Зеленый  → GPIO 23
MISO  → Белый    → GPIO 19
RST   → Оранжевый → GPIO 22
GND   → Черный   → GND
3.3V  → Красный  → 3.3V
```

**Советы:**
- Провода 15-20см длины
- Аккуратно уложи вдоль стенок коробки
- Не натягивай (крышка должна открываться)
- Можно использовать кабель-каналы или стяжки

---

### Шаг 6: USB кабель питания

```
Боковое отверстие:

  ╔═══════════╗
  ║           ║
  ║  ╭─USB─╮  ║ ← Отверстие 8-10мм
  ║  │     │  ║
  ║  ╰─────╯  ║
  ╚═══════════╝
      ↓
  USB кабель к зарядке
```

**Действия:**
1. Продень USB кабель через отверстие
2. Подключи к ESP32
3. Завяжи узелок на кабеле изнутри (чтобы не выдергивался)

---

## 🔌 Полная схема подключения

### HR Scanner (Коробка 1):

```
┌─────────────────────────────────┐
│  КРЫШКА                         │
│  [RC522] ← двойной скотч        │
│     ↓ 7 проводов                │
├─────────────────────────────────┤
│                                 │
│  LED: ● GPIO16(зеленый)         │
│       ● GPIO17(красный)         │
│                                 │
│  [ESP32 DevKit v1]              │
│   ↓ USB кабель                  │
└──┴──────────────────────────────┘
   └→ USB зарядка 5V 2A
```

**Пины:**
- RC522: GPIO 21,18,23,19,22 (SDA,SCK,MOSI,MISO,RST)
- LED зеленый: GPIO 16 → 220Ω → GND
- LED красный: GPIO 17 → 220Ω → GND
- Buzzer: GPIO 23 → GND (опционально)

---

### Security Scanner (Коробка 2):

```
┌─────────────────────────────────┐
│  КРЫШКА                         │
│  [RC522] ← двойной скотч        │
│     ↓ 7 проводов                │
├─────────────────────────────────┤
│                                 │
│  LED: ● GPIO25(зеленый)         │
│       ● GPIO26(красный)         │
│       ● GPIO27(синий-статус)    │
│                                 │
│  [ESP32 DevKit v1]              │
│   ↓ USB кабель                  │
└──┴──────────────────────────────┘
   └→ USB зарядка 5V 2A
```

**Пины:**
- RC522: GPIO 21,18,23,19,22 (те же что HR!)
- LED зеленый: GPIO 25 → 220Ω → GND
- LED красный: GPIO 26 → 220Ω → GND
- LED синий: GPIO 27 → 220Ω → GND (мигает = работает)
- Buzzer: GPIO 23 → GND (опционально)

---

## 📝 Список покупок (на 2 коробки):

### Электроника:
- ✅ 2x ESP32 DevKit v1 - $6-8
- ✅ 2x RC522 RFID модуль - $4-6
- ✅ 10x RFID карты - $2-3
- ✅ 6x LED 5мм (2 зеленых, 2 красных, 2 синих) - $1
- ✅ 6x Резистор 220 Ω - $0.5
- ✅ 2x Buzzer 5V - $1
- ✅ Провода DuPont ~40шт - $2-3
- ✅ 2x USB кабель микро (1м) - $2
- ✅ 2x Зарядка USB 5V 2A - $4-6

**Электроника ИТОГО: ~$23-30**

### Материалы:
- ✅ 2x Коробка пластиковая - $3-5
- ✅ Двойной скотч 3M - $2
- ✅ Винты M3 (набор) - $2
- ✅ Термоусадка (набор) - $2

**Материалы ИТОГО: ~$9-11**

**ВСЕГО: ~$32-41**

---

## 🔧 Процесс сборки (по времени):

1. **Подготовка коробки** - 15 минут
   - Сверление отверстий
   - Обработка краев

2. **Монтаж RC522** - 5 минут
   - Очистка поверхности
   - Приклеивание на скотч

3. **Монтаж ESP32** - 10 минут
   - Крепление винтами или скотчем

4. **Подключение проводов** - 20 минут
   - RC522 → ESP32 (7 проводов)
   - LED → резисторы → ESP32
   - Buzzer → ESP32

5. **Тестирование** - 10 минут
   - Подключение USB
   - Загрузка программы
   - Проверка RFID

**ИТОГО: ~1 час на коробку** (2 часа на обе)

---

## ⚡ Питание от USB - ОТЛИЧНО!

### Преимущества:
- ✅ Стабильное 5V питание
- ✅ Защита от помех
- ✅ Легко заменить (стандартная зарядка)
- ✅ Не нужен стабилизатор напряжения
- ✅ Индикатор на зарядке (горит = работает)

### Потребление:
```
ESP32 WiFi ON:  ~160-260 mA
RC522:          ~13-26 mA
LED x3:         ~60 mA
Buzzer:         ~30 mA (когда пищит)
───────────────────────────
ИТОГО:          ~250-350 mA (нормально)
ПИКОВОЕ:        ~500 mA (при сканировании)
```

**Зарядка 5V 1A (1000mA)** - достаточно ✅  
**Зарядка 5V 2A (2000mA)** - идеально ✅

---

## 📱 Двойной скотч для RC522 - НОРМ!

### Рекомендации:
- ✅ **3M VHB** скотч (серый или черный)
- ✅ Толщина 1-2мм
- ✅ 4 кусочка по углам RC522
- ✅ Хорошо прижми на 30 секунд

### Подготовка:
1. Обезжирь крышку спиртом
2. Высуши
3. Приклей скотч на RC522
4. Сними защитную пленку
5. Прижми к крышке изнутри
6. Подожди 24 часа для полного схватывания

⚠️ **НЕ ИСПОЛЬЗУЙ:** обычный двойной скотч (отвалится!)  
✅ **ИСПОЛЬЗУЙ:** 3M VHB или аналог (держит годами)

---

## 🎨 Маркировка коробок:

### Коробка 1 - HR (рабочее время):
```
┌─────────────────────────┐
│  ⏰ УЧЕТ ВРЕМЕНИ        │
│  ESP32-HR-001           │
│                         │
│   🟢 Готов   🔴 Ошибка │
└─────────────────────────┘
```

### Коробка 2 - Security (безопасность):
```
┌─────────────────────────┐
│  🛡️  КОНТРОЛЬ ДОСТУПА   │
│  ESP32-SEC-001          │
│                         │
│  🟢 ОК 🔴 Нет 🔵 Статус│
└─────────────────────────┘
```

Используй:
- Наклейки с принтера
- Маркер перманентный
- Самоклеящиеся этикетки

---

## 🔧 Загрузка программ:

### Для HR коробки:
1. Открой `esp32_hr_rfid.ino` в Arduino IDE
2. Проверь настройки:
   ```cpp
   const char* ssid = "Yangibay";
   const char* password = "Yangi518918";
   const char* server_url = "https://erp.bridgecore.tech";
   const char* device_id = "ESP32-HR-001";
   ```
3. Выбери плату: **ESP32 Dev Module**
4. Выбери порт: **/dev/ttyUSB0** (или COM порт)
5. Нажми **Upload** (→)
6. Открой **Serial Monitor** (115200 baud)
7. Должно быть: "СИСТЕМА ГОТОВА К РАБОТЕ!"

### Для Security коробки:
1. Открой `esp32_security_rfid.ino`
2. Те же настройки WiFi
3. `device_id = "ESP32-SEC-001"`
4. Upload
5. Serial Monitor
6. Должен мигать синий LED раз в 5 секунд

---

## 🧪 Тестирование собранных коробок:

### HR Scanner тест:
1. ✅ Подключи USB питание
2. ✅ Зеленый LED моргнет (WiFi подключен)
3. ✅ Приложи RFID карту сотрудника
4. ✅ Зеленый LED загорится на 1 сек
5. ✅ 1 короткий звук
6. ✅ В Serial Monitor: "✓ УСПЕШНО отправлено!"
7. ✅ На сайте erp.bridgecore.tech появится запись о времени

### Security Scanner тест:
1. ✅ Подключи USB питание
2. ✅ Синий LED мигает раз в 5 сек (система работает)
3. ✅ Приложи RFID карту
4. ✅ Зеленый LED = доступ разрешен (2 средних звука)
5. ✅ Красный LED = доступ запрещен (1 длинный звук)
6. ✅ На сайте erp.bridgecore.tech → Security → появится запись

---

## 📍 Размещение коробок на объекте:

### HR Scanner:
```
Расположение: У ВХОДА НА РАБОЧЕЕ МЕСТО
──────────────────────────────────────
    [ВХОД]
      ↓
  ┌───────┐
  │  📦   │ ← HR Scanner на стене
  │  ⏰   │    высота ~1.5м
  └───────┘
      
Провод USB → розетка сбоку
```

**Крепление:**
- Винты в стену (2 шт)
- Или 3M скотч на стену

---

### Security Scanner:
```
Расположение: У ВХОДА В ЗДАНИЕ/ТЕРРИТОРИЮ
───────────────────────────────────────────
    [ВХОДНАЯ ДВЕРЬ]
         ↓
    ┌─────────┐
    │   📦    │ ← Security Scanner
    │   🛡️    │    на стене у двери
    └─────────┘
    
Провод USB → розетка рядом
```

---

## 🎯 Итоговая конфигурация:

| Устройство | API Endpoint | Пины LED | Звук | Функция |
|------------|--------------|----------|------|---------|
| **HR Scanner** | `/employees/api/rfid-scan/` | GPIO 16,17 | 1 короткий | Учет времени |
| **Security** | `/security/api/scan/` | GPIO 25,26,27 | 2 средних | Контроль доступа |

---

## ✅ Почему твоя идея ЛУЧШЕ чем 2 ридера на 1 ESP32:

| Параметр | 2 ридера на 1 ESP32 | 2 отдельных ESP32 (твоя идея) |
|----------|---------------------|-------------------------------|
| **Сложность кода** | 🔴 Сложный | 🟢 Простой |
| **Надежность** | 🟡 Средняя | 🟢 Высокая |
| **Отладка** | 🔴 Сложно | 🟢 Легко |
| **Монтаж** | 🔴 Сложный | 🟢 Простой |
| **Ремонт** | 🔴 Всё сломается | 🟢 Одно работает |
| **Цена** | ~$10 | ~$15 (+$5) |

**Вывод:** Твоя идея дороже на $5, но **НАМНОГО лучше!** ✅

---

## 🎉 Готовые файлы для загрузки:

1. **esp32_hr_rfid.ino** - для HR Scanner ✅
2. **esp32_security_rfid.ino** - для Security Scanner ✅

Оба настроены на:
- WiFi: Yangibay
- Сервер: https://erp.bridgecore.tech
- Готовы к загрузке!

---

## 💡 Дополнительные улучшения (на будущее):

1. **Корпус IP54** - защита от пыли/влаги ($5-7)
2. **Реле для замка** - автоматическое открытие двери
3. **Дисплей OLED** - показывать имя сотрудника
4. **SD карта** - локальное логирование (offline mode)
5. **Батарея** - работа при отключении света

---

Загружай программы на ESP32 и собирай коробки! Будет работать отлично! 🚀
