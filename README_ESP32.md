# ESP32 Lohia Monitor - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## üìã –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ñ–µ–ª–µ–∑–æ:
- **ESP32** (–ª—é–±–∞—è –º–æ–¥–µ–ª—å)
- **RC522 RFID Reader** + RFID –∫–∞—Ä—Ç—ã
- **–ö–Ω–æ–ø–∫–∞** –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–∞—Å—Ç–µ—Ä–∞
- **Proximity sensor** –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∏–º–ø—É–ª—å—Å–æ–≤
- **–ü—Ä–æ–≤–æ–¥–∞** –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ:
- **Arduino IDE** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ESP32
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏** (—Å–º. –Ω–∏–∂–µ)

## üîß –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### ESP32 Pinout:
```
ESP32    | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç
---------|----------
3.3V     | RC522 VCC, Proximity sensor VCC
GND      | RC522 GND, –ö–Ω–æ–ø–∫–∞ GND, Proximity sensor GND
GPIO 21  | RC522 SDA (SS)
GPIO 22  | RC522 RST
GPIO 2   | –ö–Ω–æ–ø–∫–∞ (—Å pull-up)
GPIO 4   | Proximity sensor Signal
GPIO 23  | RC522 MOSI
GPIO 19  | RC522 MISO
GPIO 18  | RC522 SCK
```

### Proximity Sensor –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
**PNP –¥–∞—Ç—á–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```
–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π (Brown) ‚Üí 3.3V
–°–∏–Ω–∏–π (Blue)       ‚Üí GND
–ß–µ—Ä–Ω—ã–π (Black)     ‚Üí GPIO 4
```

**NPN –¥–∞—Ç—á–∏–∫:**
```
–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π (Brown) ‚Üí 3.3V
–°–∏–Ω–∏–π (Blue)       ‚Üí GND
–ß–µ—Ä–Ω—ã–π (Black)     ‚Üí GPIO 4
```


### –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```
ESP32 ‚îÄ‚îÄ‚îê
        ‚îú‚îÄ‚îÄ RC522 (SPI)
        ‚îú‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∞ (GPIO 2)
        ‚îî‚îÄ‚îÄ Proximity Sensor (GPIO 4)
```

## üìö –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫

–í Arduino IDE —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

1. **ArduinoJson** (6.x)
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ ‚Üí –ü–æ–∏—Å–∫ "ArduinoJson"

2. **MFRC522** (–¥–ª—è RFID)
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ ‚Üí –ü–æ–∏—Å–∫ "MFRC522"

3. **WiFi** (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ ESP32)
4. **HTTPClient** (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ ESP32)
5. **SPI** (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ ESP32)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–¥–∞

### 1. WiFi –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```cpp
const char* ssid = "YOUR_WIFI_SSID";           // –í–∞—à WiFi
const char* password = "YOUR_WIFI_PASSWORD";    // –ü–∞—Ä–æ–ª—å WiFi
```

### 2. –°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```cpp
const char* server_url = "http://192.168.1.100:8000";  // IP Django —Å–µ—Ä–≤–µ—Ä–∞
const char* esp32_id = "LOHIA-001";                    // ID ESP32
```

### 3. –ü–∏–Ω—ã (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏):
```cpp
#define SS_PIN    21    // SDA –ø–∏–Ω –¥–ª—è RC522
#define RST_PIN   22    // RST –ø–∏–Ω –¥–ª—è RC522
#define BUTTON_PIN 2    // –ü–∏–Ω –∫–Ω–æ–ø–∫–∏
#define PROXIMITY_PIN 4 // –ü–∏–Ω proximity sensor
#define SENSOR_TYPE_PNP true  // true –¥–ª—è PNP, false –¥–ª—è NPN
```

## üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Arduino IDE:
- –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—É: **ESP32 Dev Module**
- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—Ç: **COM –ø–æ—Ä—Ç –≤–∞—à–µ–≥–æ ESP32**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å: **115200 baud**

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞:
- –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `esp32_lohia_monitor.ino`
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ WiFi –∏ —Å–µ—Ä–≤–µ—Ä
- –ù–∞–∂–º–∏—Ç–µ **–ó–∞–≥—Ä—É–∑–∏—Ç—å** (Upload)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
- –û—Ç–∫—Ä–æ–π—Ç–µ **–ú–æ–Ω–∏—Ç–æ—Ä –ø–æ—Ä—Ç–∞** (115200 baud)
- –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ WiFi
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ RFID –∫–∞—Ä—Ç—ã –∏ –∫–Ω–æ–ø–∫—É

## üì± –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### RFID –∫–∞—Ä—Ç—ã:
- **–û–ø–µ—Ä–∞—Ç–æ—Ä**: –ü—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É ‚Üí –ù–∞—á–∞–ª–æ/–æ–∫–æ–Ω—á–∞–Ω–∏–µ —Å–º–µ–Ω—ã
- **–ú–∞—Å—Ç–µ—Ä**: –ü—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É ‚Üí –ü—Ä–∏–Ω—è—Ç–∏–µ/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤

### –ö–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞ –º–∞—Å—Ç–µ—Ä–∞:
- –ù–∞–∂–∞—Ç–∏–µ ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω–µ

### Proximity sensor:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Å—á–µ—Ç –∏–º–ø—É–ª—å—Å–æ–≤
- –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω–µ

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ú–æ–Ω–∏—Ç–æ—Ä –ø–æ—Ä—Ç–∞ –ø–æ–∫–∞–∂–µ—Ç:
```
üè≠ ESP32 Lohia Monitor Starting...
üì∂ Connecting to WiFi: YOUR_WIFI
‚úÖ WiFi connected!
üì° IP address: 192.168.1.50
‚úÖ ESP32 Lohia Monitor Ready!
üè∑Ô∏è RFID detected: 23690204
üöÄ Starting shift...
‚úÖ Shift start response: {"success":true,"message":"–°–º–µ–Ω–∞ –Ω–∞—á–∞—Ç–∞: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"}
üéâ Shift started successfully!
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **WiFi –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSID –∏ –ø–∞—Ä–æ–ª—å
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WiFi –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 2.4GHz

2. **–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∞–¥—Ä–µ—Å Django —Å–µ—Ä–≤–µ—Ä–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall

3. **RFID –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SPI
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞—Ä—Ç—ã –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

4. **–ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GPIO 2
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å pull-up —Ä–µ–∑–∏—Å—Ç–æ—Ä

5. **Proximity sensor —Å—á–∏—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø –¥–∞—Ç—á–∏–∫–∞ (PNP/NPN)
   - –ò–∑–º–µ–Ω–∏—Ç–µ `SENSOR_TYPE_PNP` –Ω–∞ `false` –¥–ª—è NPN –¥–∞—Ç—á–∏–∫–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–æ–≤
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞—Ç—á–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –ø–∏—Ç–∞–Ω–∏–µ 3.3V

6. **Proximity sensor –Ω–µ —Å—á–∏—Ç–∞–µ—Ç –∏–º–ø—É–ª—å—Å—ã**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –æ–±—ä–µ–∫—Ç–∞ (–æ–±—ã—á–Ω–æ 2-8–º–º)
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±—ä–µ–∫—Ç –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–∏–ø–∞ –¥–∞—Ç—á–∏–∫–∞ –≤ –∫–æ–¥–µ

## üìä API Endpoints

ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞:
- `POST /lohia/api/shift/start/` - –ù–∞—á–∞–ª–æ —Å–º–µ–Ω—ã
- `POST /lohia/api/shift/end/` - –û–∫–æ–Ω—á–∞–Ω–∏–µ —Å–º–µ–Ω—ã
- `POST /lohia/api/pulse/update/` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–ø—É–ª—å—Å–æ–≤
- `POST /lohia/api/maintenance/call/` - –í—ã–∑–æ–≤ –º–∞—Å—Ç–µ—Ä–∞

## üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥** –≤ ESP32
2. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ WiFi**
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ RFID** –∫–∞—Ä—Ç—ã
4. **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É** –≤—ã–∑–æ–≤–∞ –º–∞—Å—Ç–µ—Ä–∞
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—à–±–æ—Ä–¥** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä –ø–æ—Ä—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ ESP32
