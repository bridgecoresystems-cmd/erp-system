{% extends 'base.html' %}

{% block title %}{{ employee.get_full_name }} - –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞{% endblock %}

{% block content %}
<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h1 style="margin: 0; color: #333;">
                üë§ {{ employee.get_full_name }}
            </h1>
            <p style="margin: 5px 0 0 0; color: #666;">
                {{ employee.position }} ‚Ä¢ {{ employee.department }}
            </p>
        </div>
        <div>
            <a href="{% url 'employees:employee_edit' employee.pk %}" class="btn" style="margin-right: 10px;">
                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>
            <a href="{% url 'employees:employee_list' %}" class="btn btn-secondary">
                ‚¨ÖÔ∏è –ö —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div style="display: grid; grid-template-columns: 300px 1fr; gap: 30px; margin-bottom: 30px;">
    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Ñ–æ—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ -->
    <div class="card">
        <div style="text-align: center; margin-bottom: 25px;">
            {% if employee.photo %}
                <img src="{{ employee.photo.url }}" alt="–§–æ—Ç–æ" 
                     style="width: 200px; height: 200px; border-radius: 50%; object-fit: cover; border: 3px solid #e0e0e0;">
            {% else %}
                <div style="width: 200px; height: 200px; background: #f5f5f5; border-radius: 50%; 
                           display: flex; align-items: center; justify-content: center; margin: 0 auto; border: 3px solid #e0e0e0;">
                    <span style="font-size: 48px; color: #ccc;">üë§</span>
                </div>
            {% endif %}
        </div>
        
        <div class="employee-info">
            <div class="info-item">
                <strong>–¢–∞–±–µ–ª—å–Ω—ã–π ‚Ññ:</strong>
                <span style="font-family: monospace;">{{ employee.employee_id }}</span>
            </div>
            
            <div class="info-item">
                <strong>–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞:</strong>
                {{ employee.hire_date|date:"d.m.Y" }}
            </div>
            
            <div class="info-item">
                <strong>RFID –∫–∞—Ä—Ç–∞:</strong>
                {% if employee.rfid_uid %}
                    <span style="color: #4caf50;">üé´ {{ employee.rfid_uid }}</span>
                {% else %}
                    <span style="color: #f44336;">‚ùå –ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞</span>
                {% endif %}
            </div>
            
            <div class="info-item">
                <strong>–°—Ç–∞—Ç—É—Å:</strong>
                {% if employee.is_active %}
                    <span style="color: #4caf50; font-weight: bold;">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
                {% else %}
                    <span style="color: #f44336; font-weight: bold;">‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                {% endif %}
            </div>
            
            {% if employee.phone %}
            <div class="info-item">
                <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong>
                <a href="tel:{{ employee.phone }}">{{ employee.phone }}</a>
            </div>
            {% endif %}
            
            {% if employee.email %}
            <div class="info-item">
                <strong>Email:</strong>
                <a href="mailto:{{ employee.email }}">{{ employee.email }}</a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
            <div class="stat-card">
                <div class="stat-number">{{ stats.total_work_days }}</div>
                <div class="stat-label">–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –∑–∞ –º–µ—Å—è—Ü</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number">{{ stats.total_hours|floatformat:1 }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ —á–∞—Å–æ–≤</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number">{{ stats.average_hours|floatformat:1 }}</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ —á–∞—Å–æ–≤/–¥–µ–Ω—å</div>
            </div>

        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è -->
        {% if stats.total_work_days > 0 %}
        <div class="card">
            <h3 style="margin: 0 0 20px 0; color: #333;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è (30 –¥–Ω–µ–π)</h3>
            <div style="display: flex; gap: 20px;">
                <div class="presence-stat">
                    <div style="font-size: 2em; color: #4caf50;">{{ stats.present_days }}</div>
                    <div>–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</div>
                </div>
                <div class="presence-stat">
                    <div style="font-size: 2em; color: #ff9800;">{{ stats.late_days }}</div>
                    <div>–û–ø–æ–∑–¥–∞–Ω–∏—è</div>
                </div>
                <div class="presence-stat">
                    <div style="font-size: 2em; color: #2196f3;">{{ stats.partial_days }}</div>
                    <div>–ù–µ–ø–æ–ª–Ω—ã–µ –¥–Ω–∏</div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º -->
<div class="tab-navigation">
    <button type="button" class="tab-btn active" onclick="showTab('worktime')">
        ‚è∞ –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
    </button>
    <button type="button" class="tab-btn" onclick="showTab('access')">
        üé´ –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–∞
    </button>
    <button type="button" class="tab-btn" onclick="showTab('details')">
        üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    </button>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞: –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è -->
<div class="tab-content active" id="tab-worktime">
    <div class="card">
        <h3 style="margin: 0 0 20px 0; color: #333;">‚è∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
        
        {% if recent_worktime %}
            <div style="overflow-x: auto;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ü—Ä–∏—Ö–æ–¥</th>
                            <th>–£—Ö–æ–¥</th>
                            <th>–ß–∞—Å—ã</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in recent_worktime %}
                        <tr>
                            <td>
                                <strong>{{ entry.date|date:"d.m.Y" }}</strong><br>
                                <small style="color: #666;">{{ entry.date|date:"l" }}</small>
                            </td>
                            <td>
                                {% if entry.entry_time %}
                                    {{ entry.entry_time|time:"H:i" }}
                                {% else %}
                                    <span style="color: #999;">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if entry.exit_time %}
                                    {{ entry.exit_time|time:"H:i" }}
                                {% else %}
                                    <span style="color: #999;">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if entry.hours_worked %}
                                    <span style="font-weight: bold;">{{ entry.get_hours_display }}</span>
                                {% else %}
                                    <span style="color: #999;">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>
                                <span style="color: {{ entry.get_status_display_color }}; font-weight: bold;">
                                    ‚óè {{ entry.get_status_display }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align: center; padding: 40px; color: #666;">
                üìÖ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            </div>
        {% endif %}
    </div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞: –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–∞ -->
<div class="tab-content" id="tab-access">
    <div class="card">
        <h3 style="margin: 0 0 20px 0; color: #333;">üé´ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–∞—Å–∞–Ω–∏—è –∫–∞—Ä—Ç—ã</h3>
        
        {% if recent_accesses %}
            <div class="access-timeline">
                {% for access in recent_accesses %}
                <div class="access-item">
                    <div class="access-time">
                        <strong>{{ access.timestamp|date:"d.m.Y" }}</strong><br>
                        <span style="color: #666;">{{ access.timestamp|time:"H:i:s" }}</span>
                    </div>
                    <div class="access-details">
                        <div style="font-weight: 500;">–ö–∞—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã</div>
                        <small style="color: #666;">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {{ access.device_id }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 40px; color: #666;">
                üé´ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–æ—Å—Ç—É–ø–∞
            </div>
        {% endif %}
    </div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div class="tab-content" id="tab-details">
    <div class="card">
        <h3 style="margin: 0 0 20px 0; color: #333;">üìã –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ</h3>
        
        <div class="details-grid">
            <div class="detail-section">
                <h4>üë§ –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h4>
                <div class="detail-item">
                    <strong>–§–ò–û:</strong> {{ employee.get_full_name }}
                </div>
                {% if employee.birth_date %}
                <div class="detail-item">
                    <strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ employee.birth_date|date:"d.m.Y" }}
                    {% if employee.get_age %}
                        ({{ employee.get_age }} –ª–µ—Ç)
                    {% endif %}
                </div>
                {% endif %}
                {% if employee.gender %}
                <div class="detail-item">
                    <strong>–ü–æ–ª:</strong> {{ employee.get_gender_display }}
                </div>
                {% endif %}
            </div>
            
            <div class="detail-section">
                <h4>üè¢ –†–∞–±–æ—á–∏–µ –¥–∞–Ω–Ω—ã–µ</h4>
                <div class="detail-item">
                    <strong>–û—Ç–¥–µ–ª:</strong> {{ employee.department }}
                </div>
                <div class="detail-item">
                    <strong>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</strong> {{ employee.position }}
                </div>
                <div class="detail-item">
                    <strong>–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞:</strong> {{ employee.hire_date|date:"d.m.Y" }}
                </div>
            </div>
            
            {% if employee.passport_series or employee.inn %}
            <div class="detail-section">
                <h4>üìã –î–æ–∫—É–º–µ–Ω—Ç—ã</h4>
                {% if employee.passport_series %}
                <div class="detail-item">
                    <strong>–ü–∞—Å–ø–æ—Ä—Ç:</strong> {{ employee.get_passport_full }}
                </div>
                {% endif %}
                {% if employee.inn %}
                <div class="detail-item">
                    <strong>–ò–ù–ù:</strong> {{ employee.inn }}
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
function showTab(tabName) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.getElementById('tab-' + tabName).classList.add('active');
    
    // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π
    event.target.classList.add('active');
}
</script>

<style>
.info-item {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #f0f0f0;
}

.info-item:last-child {
    border-bottom: none;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 5px;
}

.stat-label {
    color: #666;
    font-size: 14px;
}

.presence-stat {
    text-align: center;
    flex: 1;
}

.presence-stat div:first-child {
    font-weight: bold;
    margin-bottom: 5px;
}

.tab-navigation {
    display: flex;
    background: white;
    border-radius: 12px;
    padding: 5px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    gap: 5px;
}

.tab-btn {
    flex: 1;
    padding: 12px 15px;
    border: none;
    background: transparent;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
    color: #666;
}

.tab-btn:hover {
    background: #f8f9fa;
    color: #333;
}

.tab-btn.active {
    background: #667eea;
    color: white;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

.access-timeline {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.access-item {
    display: flex;
    gap: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    align-items: center;
}

.access-time {
    min-width: 120px;
    text-align: center;
}

.access-details {
    flex: 1;
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
}

.detail-section h4 {
    margin: 0 0 15px 0;
    color: #333;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
}

.detail-item {
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
}

.detail-item strong {
    min-width: 120px;
    color: #555;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}