{% extends 'base.html' %}
{% load static %}
{% load tz %}

{% block content %}
<div class="security-body">
    <div class="security-container" style="max-width: 1200px;">
        <div class="security-header text-center">
            <h1>üìä –û—Ç—á–µ—Ç –ø–æ –ª–æ–≥–∞–º –æ—Ö—Ä–∞–Ω—ã</h1>
            <a href="{% url 'security:dashboard' %}" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏</a>
        </div>

        <div class="filters">
            <form method="get" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="date_from" class="form-label">–î–∞—Ç–∞ —Å:</label>
                    <input type="date" id="date_from" name="date_from" value="{{ date_from }}" class="form-control">
                </div>
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="date_to" class="form-label">–î–∞—Ç–∞ –ø–æ:</label>
                    <input type="date" id="date_to" name="date_to" value="{{ date_to }}" class="form-control">
                </div>
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="employee" class="form-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label>
                    <select id="employee" name="employee" class="form-control">
                        <option value="">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                        {% for employee in employees %}
                        <option value="{{ employee.id }}" 
                                {% if employee.id|stringformat:"s" == selected_employee %}selected{% endif %}>
                            {{ employee.get_full_name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px; flex-wrap: nowrap;">
                    <button type="submit" class="btn" style="flex: 1; min-width: 100px;">üîç –§–∏–ª—å—Ç—Ä</button>
                    <a href="{% url 'security:logs_report' %}" class="btn btn-secondary" style="flex: 1; min-width: 100px;">üîÑ –°–±—Ä–æ—Å</a>
                </div>
            </form>
        </div>

        <div class="logs-table">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ–∫–∞–∑–∞–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 –∑–∞–ø–∏—Å–µ–π)</h3>
            {% if logs %}
            <table>
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                        <th>–û—Ö—Ä–∞–Ω–Ω–∏–∫</th>
                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr>
                        <td>{{ log.timestamp|date:"d.m.Y" }}</td>
                        <td>{{ log.timestamp|localtime|date:"H:i" }}</td>
                        <td>{{ log.employee.get_full_name }}</td>
                        <td class="action-{{ log.action }}">
                            {% if log.action == 'in' %}
                                ‚û°Ô∏è {{ log.get_action_display }}
                            {% else %}
                                ‚¨ÖÔ∏è {{ log.get_action_display }}
                            {% endif %}
                        </td>
                        <td>{{ log.security_guard.username|default:"‚Äî" }}</td>
                        <td>{{ log.notes|default:"‚Äî" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="no-data">
                üìã –ó–∞–ø–∏—Å–µ–π –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            </div>
            {% endif %}
        </div>

        {% if logs %}
        <div class="export-section">
            <h3>üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <a href="{% url 'security:export_excel' %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}" 
               class="btn btn-success">
                üìä –°–∫–∞—á–∞—Ç—å Excel —Å —Ç–µ–∫—É—â–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}