# 🔔 Уведомления для завода - ЧТО ДОБАВЛЕНО

## ✅ Реализовано

### 1. 🔊 **ГРОМКИЙ свой звук**
- Файл: `alarm.mp3` (из твоей системы)
- Расположение: `android/app/src/main/res/raw/alarm.mp3`
- Будет играть ВМЕСТО стандартного звука Android

### 2. 📳 **Мощная вибрация**
- **Тройная вибрация**: БЗЗ (500мс) → пауза (200мс) → БЗЗ → пауза → БЗЗ
- Паттерн: `[0, 500, 200, 500, 200, 500]`
- **Невозможно не заметить!**

### 3. 📱 **Полноэкранное окно**
- При вызове мастера → приложение **открывается ПОВЕРХ всего**
- Даже если телефон заблокирован!
- `fullScreenIntent: true`

### 4. 🔒 **Нельзя закрыть просто так**
- Уведомление **нельзя смахнуть**
- Остается пока мастер не нажмет на него
- `ongoing: true`, `autoCancel: false`

### 5. 🔴 **Красный мигающий LED**
- Индикатор на телефоне мигает **красным**
- Горит 1 сек, выключен 0.5 сек
- `ledColor: красный`

### 6. ⚠️ **Категория ALARM**
- **Обходит режим "Не беспокоить"**!
- Максимальный приоритет
- `category: AndroidNotificationCategory.alarm`

---

## 📋 Разрешения Android

Добавлены в `AndroidManifest.xml`:

```xml
<uses-permission android:name="android.permission.VIBRATE"/>
<uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>
<uses-permission android:name="android.permission.USE_FULL_SCREEN_INTENT"/>
<uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW"/>
<uses-permission android:name="android.permission.WAKE_LOCK"/>
```

---

## 🎯 Как это работает на заводе

### Когда оператор нажимает кнопку "Вызов мастера":

1. **ESP32** отправляет на сервер: "Вызов на станке Lohia #1"
2. **Сервер** создает запись в БД и отправляет **WebSocket**
3. **Приложение мастера** получает сообщение
4. **СРАЗУ происходит**:
   - 📳 Телефон **ВИБРИРУЕТ** 3 раза
   - 🔊 Играет **ГРОМКИЙ звук** alarm.mp3
   - 📱 Приложение **открывается ПОВЕРХ ВСЕГО**
   - 🔴 LED **мигает красным**
   - 🔔 Уведомление **нельзя закрыть** просто так

### Что видит мастер:

```
╔═══════════════════════════════════╗
║  🔧 ВЫЗОВ МАСТЕРА!                ║
║  Станок: Lohia #1 - СРОЧНО!      ║
╚═══════════════════════════════════╝
```

---

## 🧪 Тестирование

После установки APK проверь:

1. ✅ **Звук**: Должен играть твой `alarm.mp3`
2. ✅ **Вибрация**: Тройная вибрация БЗЗ-БЗЗ-БЗЗ
3. ✅ **Полноэкранное окно**: Приложение открывается поверх всего
4. ✅ **Нельзя закрыть**: Смахивание не работает
5. ✅ **LED**: Мигает красным (если есть на телефоне)
6. ✅ **Работает в фоне**: Даже когда приложение закрыто

---

## 📊 Сборка APK

**Текущий статус**: Собирается для `android-arm64` (90% телефонов)

**Команда**:
```bash
flutter build apk --release --target-platform android-arm64 --split-per-abi
```

**Где будет APK**:
```
master_app/build/app/outputs/flutter-apk/app-arm64-v8a-release.apk
```

---

## 🚀 Установка на телефон

1. Скопируй APK на телефон
2. Установи (разреши "Неизвестные источники")
3. При первом запуске разреши все разрешения:
   - ✅ Уведомления
   - ✅ Полноэкранные уведомления
   - ✅ Работа в фоне
   - ✅ Автозапуск

---

## 🎉 Готово!

Теперь мастера на заводе **ТОЧНО услышат** вызовы! 🔊📳📱

